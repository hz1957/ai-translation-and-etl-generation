{
  "uId": null,
  "dataFlowId": "genai_etl_flow_1756272100000",
  "domId": "clinical_data",
  "name": "受试者最新不良事件分析",
  "description": "整合CDASH_AE和CDASH_DM数据集，输出每位受试者的年龄及其最新的不良事件记录",
  "platform": "bi",
  "meta": [
    {
      "type": "INPUT_DATASET",
      "name": "CDASH_AE",
      "displayType": "CSV",
      "preview": { "scope": "ALL", "config": {} },
      "cascadeUpdateEnabled": false,
      "inputDsId": "facddcc2ccc8f4be4823c07b",
      "id": "id_1756272056325",
      "relativeFieldAlias": {},
      "position": { "x": 667, "y": -82 },
      "sources": []
    },
    {
      "type": "INPUT_DATASET",
      "name": "CDASH_DM",
      "displayType": "CSV",
      "preview": { "scope": "ALL", "config": {} },
      "cascadeUpdateEnabled": false,
      "inputDsId": "d1eb397adbf35428eaa15793",
      "id": "id_1756272073121",
      "relativeFieldAlias": {},
      "position": { "x": 669, "y": 182 },
      "sources": []
    },
    {
      "type": "CALCULATOR",
      "name": "添加AE日期时间字段",
      "id": "calc_ae_datetime",
      "formulas": [
        {
          "name": "AE开始时间",
          "type": "TIMESTAMP",
          "expr": "coalesce(concat([开始日期], ' ', [开始时间]), [开始日期])",
          "key": "ae_start_timestamp"
        }
      ],
      "position": { "x": 867, "y": -82 },
      "sources": ["id_1756272056325"]
    },
    {
      "type": "CALCULATOR",
      "name": "生成排序排名",
      "id": "calc_rank",
      "formulas": [
        {
          "name": "最新AE排名",
          "type": "INT",
          "expr": "row_number() over(partition by [受试者] order by [AE开始时间] desc)",
          "key": "latest_ae_rank"
        }
      ],
      "position": { "x": 1067, "y": -82 },
      "sources": ["calc_ae_datetime"]
    },
    {
      "type": "FILTER_ROWS",
      "name": "筛选最新不良事件",
      "id": "filter_latest_ae",
      "conditions": [
        {
          "name": "最新AE排名",
          "fdType": "INT",
          "filterType": "EQ",
          "filterValue": [{"v": "1", "type": "VALUE"}]
        }
      ],
      "combineType": "AND",
      "position": { "x": 1267, "y": -82 },
      "sources": ["calc_rank"]
    },
    {
      "type": "SELECT_COLUMNS",
      "name": "AE选择输出字段",
      "id": "select_ae_columns",
      "columns": [
        {"name": "受试者", "dsKey": "filter_latest_ae", "isIgnored": false},
        {"name": "不良事件名称", "dsKey": "filter_latest_ae", "isIgnored": false},
        {"name": "AE开始时间", "dsKey": "filter_latest_ae", "newName": "最新AE开始时间", "isIgnored": false}
      ],
      "position": { "x": 1467, "y": -82 },
      "sources": ["filter_latest_ae"]
    },
    {
      "type": "SELECT_COLUMNS",
      "name": "DM选择输出字段",
      "id": "select_dm_columns",
      "columns": [
        {"name": "受试者", "dsKey": "id_1756272073121", "isIgnored": false},
        {"name": "年龄", "dsKey": "id_1756272073121", "isIgnored": false}
      ],
      "position": { "x": 869, "y": 182 },
      "sources": ["id_1756272073121"]
    },
    {
      "type": "JOIN_DATA",
      "name": "关联受试者与最新AE",
      "id": "join_subject_latest_ae",
      "dataFusion": {
        "dataSources": [
          {"key": "select_dm_columns"},
          {"key": "select_ae_columns"}
        ],
        "fusionType": "COLUMN",
        "columnFuses": [
          {
            "leftKey": "select_dm_columns",
            "rightKey": "select_ae_columns",
            "joinType": "LEFT_OUTER",
            "predicates": [
              {
                "leftColumn": "受试者",
                "rightColumn": "受试者"
              }
            ]
          }
        ],
        "selectedColumns": [
          {"name": "受试者", "dsKey": "select_dm_columns", "isIgnored": false},
          {"name": "年龄", "dsKey": "select_dm_columns", "isIgnored": false},
          {"name": "不良事件名称", "dsKey": "select_ae_columns", "newName": "最新不良事件", "isIgnored": false}
        ]
      },
      "position": { "x": 1667, "y": 50 },
      "sources": ["select_dm_columns", "select_ae_columns"]
    },
    {
      "type": "OUTPUT_DATASET",
      "name": "受试者最新不良事件",
      "id": "output_latest_ae",
      "outputDsName": "Subject_Latest_AE",
      "parentDirId": "output_dir_clinical",
      "dataSource": {
        "created": true,
        "dsId": "output_ds_123456",
        "name": "Subject_Latest_AE",
        "dirPath": [
          {"dirId": "dir_001", "dirName": "临床数据分析"}
        ]
      },
      "position": { "x": 1867, "y": 50 },
      "sources": ["join_subject_latest_ae"]
    }
  ],
  "inputs": [
    {
      "dsId": "facddcc2ccc8f4be4823c07b",
      "name": "CDASH_AE",
      "fields": [
        { "name": "研究中心", "type": "STRING", "seqNo": 0 },
        { "name": "中心编号", "type": "LONG", "seqNo": 1 },
        { "name": "受试者", "type": "STRING", "seqNo": 2 },
        { "name": "页面名称", "type": "STRING", "seqNo": 3 },
        { "name": "记录号", "type": "LONG", "seqNo": 4 },
        { "name": "不良事件名称", "type": "STRING", "seqNo": 5 },
        { "name": "开始日期", "type": "DATE", "seqNo": 6 },
        { "name": "开始时间", "type": "STRING", "seqNo": 7 },
        { "name": "结束日期", "type": "DATE", "seqNo": 8 },
        { "name": "结束时间", "type": "STRING", "seqNo": 9 },
        { "name": "AE分类", "type": "STRING", "seqNo": 10 },
        { "name": "是否为严重不良事件", "type": "STRING", "seqNo": 11 },
        { "name": "是否为限制性毒性事件", "type": "STRING", "seqNo": 12 },
        { "name": "严重程度（CTCAE）", "type": "STRING", "seqNo": 13 },
        { "name": "与研究用药的因果关系", "type": "STRING", "seqNo": 14 },
        { "name": "是否因严重不良事件退出试验", "type": "STRING", "seqNo": 15 },
        { "name": "IrAE", "type": "STRING", "seqNo": 16 },
        { "name": "是否导致药物暂停", "type": "STRING", "seqNo": 17 },
        { "name": "是否导致药物降低剂量", "type": "STRING", "seqNo": 18 },
        { "name": "是否导致永久停药", "type": "STRING", "seqNo": 19 }
      ]
    },
    {
      "dsId": "d1eb397adbf35428eaa15793",
      "name": "CDASH_DM",
      "fields": [
        { "name": "研究中心", "type": "STRING", "seqNo": 0 },
        { "name": "中心编号", "type": "LONG", "seqNo": 1 },
        { "name": "项目", "type": "STRING", "seqNo": 2 },
        { "name": "方案编号", "type": "STRING", "seqNo": 3 },
        { "name": "受试者", "type": "STRING", "seqNo": 4 },
        { "name": "受试者状态", "type": "STRING", "seqNo": 5 },
        { "name": "页面名称", "type": "STRING", "seqNo": 6 },
        { "name": "出生日期", "type": "DATE", "seqNo": 7 },
        { "name": "年龄", "type": "LONG", "seqNo": 8 },
        { "name": "年龄_UNIT", "type": "STRING", "seqNo": 9 },
        { "name": "性别", "type": "STRING", "seqNo": 10 },
        { "name": "民族", "type": "STRING", "seqNo": 11 },
        { "name": "身高", "type": "LONG", "seqNo": 12 },
        { "name": "身高_UNIT", "type": "STRING", "seqNo": 13 },
        { "name": "WEIGHT", "type": "DOUBLE", "seqNo": 14 },
        { "name": "WEIGHT_UNIT", "type": "STRING", "seqNo": 15 },
        { "name": "受试者情况", "type": "STRING", "seqNo": 16 },
        { "name": "年龄分组（n, %）", "type": "STRING", "seqNo": 17 },
        { "name": "AGE-N(Nmiss)", "type": "LONG", "seqNo": 18 },
        { "name": "AGE-Mean±Std", "type": "LONG", "seqNo": 19 },
        { "name": "AGE-M (Q1~Q3)", "type": "LONG", "seqNo": 20 },
        { "name": "AGE-Min~Max", "type": "LONG", "seqNo": 21 },
        { "name": "诊断", "type": "STRING", "seqNo": 22 },
        { "name": "现阶段分期", "type": "STRING", "seqNo": 23 },
        { "name": "ECOG评分", "type": "LONG", "seqNo": 24 },
        { "name": "转移器官数量", "type": "STRING", "seqNo": 25 },
        { "name": "PD-L1表达状态", "type": "STRING", "seqNo": 26 }
      ]
    }
  ],
  "outputs": []
}